
@{
    ViewData["Title"] = "OrderDetails";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-xxl flex-grow-1 container-p-y">

    <div class="row">
        <!-- Form controls -->
        <div class="col-md-12">
            <div class="card mb-4">
                <h5 class="card-header">Order Details</h5>
                <div class="card-body demo-vertical-spacing demo-only-element">
                   <div class="row">
                       <div class="col-md-12">
                            @{
                                int totalqty = 0;
                                foreach (var item in Model)
                                {
                                    if (Convert.ToInt32(item.updated_qty) > 0)
                                    {

                                        totalqty = totalqty + Convert.ToInt32(item.updated_qty);
                                    }
                                    else
                                    {
                                        totalqty = totalqty + Convert.ToInt32(item.qty);
                                    
                                    }
                                }

                                decimal totalamt = 0;
                                foreach (var item in Model)
                                {
                                    if (Convert.ToDecimal(item.updated_amount) > 0)
                                     {

                                        totalamt = totalamt + Convert.ToDecimal(item.updated_amount);
                                    }
                                    else
                                    {
                                        totalamt = totalamt + Convert.ToDecimal(item.total_amount);

                                    }
                                }
                            }
                            <table class="datatables-basic table table-bordered">
                               <tr>
                                    <td><span class="fw-medium mx-2">Order No:</span> <span>@Model[0].orderno</span></td>
                                    <td><span class="fw-medium mx-2">Total Qty.:</span> <span>@totalqty</span></td>
                               </tr>
                                <tr>
                                    <td><span class="fw-medium mx-2">Order Date:</span> <span>@Model[0].order_date</span></td>
                                    <td><span class="fw-medium mx-2">GST Amount:</span> <span></span></td>
                                </tr>
                                <tr>
                                    <td><span class="fw-medium mx-2">Client Name:</span> <span>@Model[0].client</span></td>
                                    <td><span class="fw-medium mx-2">Total Amount:</span> <span>@totalamt</span></td>
                                </tr>
                                <tr>
                                    <td><span class="fw-medium mx-2">User Name:</span> <span>@Model[0].username</span></td>
                                    <td>@if (Model[0].status == 6)
                                        {
                                            <button class="btn btn-success btn-sm" onclick="Approved_order(@Model[0].orderid)">Approved Order</button> 
                                            <button class="btn btn-danger btn-sm" onclick="Rejected_order(@Model[0].orderid)">Reject Order</button>
                                        }
                                    </td>
                                </tr>
                           </table>
                          
                            
                       </div>
                      
                   </div>
                   
                    <div class="row">
                        <div class="col-md-12">
                            <div class="card-datatable table-responsive pt-0">
                                <table class="datatables-basic table table-bordered">
                                    <thead>
                                        <tr>
                                            <th>Id</th>
                                            <th>Image</th>
                                            <th>Description</th>
                                            <th>Category</th>
                                            <th>MRP</th>
                                            <th>Req. QTY</th>
                                            @if (Model[0].status == 6)
                                             {
                                            <th style="width:15%">Updated QTY</th>
                                             }
                                            <th>Total</th>
                                            <th>Status</th>
                                            @if (Model[0].status == 6)
                                             {
                                            <th>Action</th>
                                             }
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @{
                                            foreach (var item in Model)
                                            {
                                                        <tr>
                                                            <td>@item.id</td>
                                                            <td><img src="~/uploads/@item.ImageUrl" /></td>
                                                            <td>@item.Description</td>
                                                            <td>@item.category</td>
                                                            <td>@item.rate</td>
                                                            <td>@item.qty</td>
                                                    @if (item.status == 6)
                                                    {
                                                        <td>
                                                            <div class="row">
                                                                <div class="col-md-7">
                                                                    <input type="text" class="form-control" value="@item.updated_qty" id="txtqty_@item.id" />
                                                                </div>
                                                                <div class="col-md-4">
                                                                    <button type="button" class="btn btn-primary btn-sm" onclick="update_qty(@item.id,@item.rate,@item.orderid)"><i class="mdi mdi-content-save-check-outline"></i></button>
                                                                </div>
                                                            </div>
                                                        </td>
                                                    }
                                                    <td> @if (Convert.ToInt32(@item.updated_qty) > 0)
                                                        {
                                                            @item.updated_amount
                                                        } else
                                                        {
                                                            @item.total_amount
                                                        }
                                                    </td>
                                                    <td>
                                                        @if (item.is_reject == 1)
                                                        {

                                                            <span class="badge bg-danger">Reject</span>
                                                        }
                                                        else
                                                        {
                                                            <span>-</span>
                                                            
                                                        }
                                                    </td>
                                                    @if (item.status == 6)
                                                    {
                                                        <td>
                                                            @if (item.is_reject == 1)
                                                            {

                                                                <span>-</span>
                                                            }
                                                            else
                                                            {

                                                                <button type="button" class="btn btn-warning btn-sm" onclick="reject_item(@item.id,@item.orderid)"><i class="mdi mdi-                                                              close-circle-outline"></i> Reject</button>
                                                            }
                                                        </td>
                                                    }
                                                </tr>

                                            }
                                        }

                                    </tbody>
                                </table>
                            </div>
                        </div>

                    </div>

                </div>
            </div>
        </div>


    </div>

</div>

@section Scripts {
  
    function update_qty(id,rate,orderid) {
        Swal.fire({
            title: "Are you sure?",
            text: "You won't be able to revert this!",
            icon: "warning",
            showCancelButton: !0,
            confirmButtonText: "Yes, Update it!",
            customClass: {
                confirmButton: "btn btn-primary me-3 waves-effect waves-light",
                cancelButton: "btn btn-outline-secondary waves-effect"
            },
            buttonsStyling: !1
        }).then(function (t) {
            if(t.isConfirmed==true)
            {
                window.location.href = "../order/update_qty?id=" + id + "&qty=" + $("#txtqty_" + id + "").val() + "&rate=" + rate + "&orderid="+orderid+"";
            }
        })
    }
       
    
    function reject_item(id, orderid) {
            Swal.fire({
                title: "Are you sure?",
                text: "You won't be able to revert this!",
                icon: "warning",
                showCancelButton: !0,
                confirmButtonText: "Yes, Reject it!",
                customClass: {
                    confirmButton: "btn btn-primary me-3 waves-effect waves-light",
                    cancelButton: "btn btn-outline-secondary waves-effect"
                },
                buttonsStyling: !1
            }).then(function (t) {
                if (t.isConfirmed == true) {
                    window.location.href = "../order/reject_item?id=" + id + "&orderid=" + orderid + "";
                }
            })
        }

          function Approved_order(orderid) {
            Swal.fire({
                title: "Are you sure?",
                text: "You won't be able to revert this!",
                icon: "warning",
                showCancelButton: !0,
                confirmButtonText: "Yes, Approved it!",
                customClass: {
                    confirmButton: "btn btn-success me-3 waves-effect waves-light",
                    cancelButton: "btn btn-outline-secondary waves-effect"
                },
                buttonsStyling: !1
            }).then(function (t) {
                if (t.isConfirmed == true) {
                    window.location.href = "../order/update_order_status?status=12&id=" + orderid + "";
                }
            })
        }

         function Rejected_order(orderid) {
            Swal.fire({
                title: "Are you sure?",
                text: "You won't be able to revert this!",
                icon: "warning",
                showCancelButton: !0,
                confirmButtonText: "Yes, Reject it!",
                customClass: {
                    confirmButton: "btn btn-danger me-3 waves-effect waves-light",
                    cancelButton: "btn btn-outline-secondary waves-effect"
                },
                buttonsStyling: !1
            }).then(function (t) {
                if (t.isConfirmed == true) {
                    window.location.href = "../order/update_order_status?status=13&id=" + orderid + "";
                }
            })
        }
}

